<!-- FILE:/index.html (REPLACE WHOLE FILE) -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>

  <title>MXD — Trang chủ</title>
  <meta name="description" content="MXD: Trung tâm mua sắm affiliate ngành xây dựng, cập nhật nhanh, ảnh .webp tối ưu, đo lường đầy đủ.">
  <link rel="canonical" href="https://mxd210.github.io/">
  <meta name="robots" content="index,follow">

  <!-- OG -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="MXD — Trang chủ">
  <meta property="og:description" content="Danh mục rõ ràng, sản phẩm chuẩn ảnh .webp, link đo lường qua affiliate.">
  <meta property="og:url" content="https://mxd210.github.io/">
  <meta property="og:image" content="https://mxd210.github.io/assets/img/og/home.webp">

  <!-- VERIFY -->
  <meta name="google-site-verification" content="84L0tRVs_wNPAyXii38-OaeGi8TyJdMlkZXVIHcnj0o">

  <!-- MXD-ANCHOR:HEAD-META -->
  <link rel="stylesheet" href="/assets/site.css">
  <link rel="prefetch" href="/store/my-pham.html">

  <style>
    :root{
      --bg:#ffffff; --text:#111; --muted:#6b7280; --border:#e5e7eb;
      --card:#ffffff; --brand:#ff6a00; --brand-contrast:#ffffff;
      --hover:#111; --radius:16px; --gap:24px; --shadow:0 6px 20px rgba(0,0,0,.06);
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0f1215; --text:#e8e8e8; --muted:#a2a2a2; --border:#262b31; --card:#14181d; --shadow:0 10px 28px rgba(0,0,0,.35) }
    }

    html,body{height:100%}
    body{ margin:0; background:var(--bg); color:var(--text);
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans","DejaVu Sans",sans-serif;
      text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased }
    a{color:var(--brand); text-decoration:none}
    a:hover{opacity:.9}
    header,footer{padding:12px 16px; border-bottom:1px solid var(--border)}
    footer{border-bottom:none;border-top:1px solid var(--border); margin-top:24px}
    .container{max-width:1180px;margin:0 auto;padding:0 16px}
    .muted{color:var(--muted)}
    .sr-only{position:absolute;left:-9999px}

    /* NAV strip (giữ như cũ rút gọn) */
    .site-nav{display:flex;gap:10px;margin-left:auto;flex-wrap:wrap;background:linear-gradient(135deg,#1746ff,#1a94ff);padding:6px 10px;border-radius:14px;border:1px solid rgba(255,255,255,.18);box-shadow:0 10px 24px rgba(23,70,255,.20)}
    .nav-link{ padding:8px 10px; border-radius:10px; color:#fff; text-decoration:none }
    .nav-link:hover{ background:rgba(255,255,255,.14) }
    .nav-link[aria-current="page"]{ background:rgba(255,255,255,.22) }

    /* HERO */
    .hero{ margin:12px 0 0; border-radius:20px; overflow:hidden; position:relative;
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55)), url('/assets/img/hero/home-hero.webp') center/cover no-repeat;
      min-height:240px; box-shadow:var(--shadow) }
    .hero-fallback{ background:linear-gradient(135deg,#1f2937,#111827) }
    .hero-inner{padding:26px; color:#fff}
    .hero h1{margin:0 0 6px; font-size:28px; line-height:1.2}
    .hero p{margin:0 0 14px; opacity:.95}
    .cta{ display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:#fff;padding:10px 14px;border-radius:12px;font-weight:800;border:1px solid transparent }
    .cta:hover{filter:brightness(1.05)}
    @media (max-width:540px){ .hero{min-height:200px} .hero-inner{padding:18px} .hero h1{font-size:22px} }

    /* GRID & CARD (desktop mặc định) */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--gap);margin:16px 0}
    .card{ border:1px solid var(--border); border-radius:var(--radius); background:var(--card);
      overflow:hidden; display:flex; flex-direction:column; box-shadow:var(--shadow); height:100% }
    .card:hover{ transform:translateY(-2px) }
    .card .body{ padding:12px }

    .name,.product-title{ display:block !important; font-size:16px; line-height:1.35; margin:0 0 6px;
      -webkit-line-clamp:2; display:-webkit-box; -webkit-box-orient:vertical; overflow:hidden; min-height:2.7em }
    .price{ font-weight:800; margin:4px 0 10px }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .buy{ display:inline-block; width:100%; text-align:center; padding:10px 12px; border-radius:12px; font-weight:800;
      text-decoration:none; color:#fff; border:1px solid transparent; background:var(--brand) }
    .buy[data-merchant="shopee"]{ background:#ee4d2d; border-color:#ee4d2d }
    .buy[data-merchant="lazada"]{ background:#0f146d; border-color:#0f146d }
    .buy[data-merchant="tiki"]{ background:#1a94ff; border-color:#1a94ff }
    .buy[data-merchant="tiktok"]{ background:#000; border-color:#000 }
    .buy:hover{ filter:brightness(1.05) }

    /* COMPACT MOBILE CARDS */
    .thumb{ position:relative; background:#f7f7f7 }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
    .aspect-4-5{ aspect-ratio:4/5 }
    .sale-badge{ position:absolute; left:8px; top:8px; background:#ef4444; color:#fff; padding:2px 6px; font-size:11px; border-radius:999px; font-weight:700 }
    .m-badge{ position:absolute; right:8px; top:8px; background:rgba(0,0,0,.72); color:#fff; padding:2px 6px; font-size:11px; border-radius:8px }

    @media (max-width:480px){
      .grid.compact{ grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px }
      .card{ border-radius:12px }
      .card .body{ padding:8px }
      .name{ font-size:14px; min-height:2.4em }
      .price{ font-size:14px; margin:2px 0 8px }
      .buy{ padding:8px 10px; font-size:13px; border-radius:10px }
    }

    /* QUICK-NAV & METRICS (giữ như cũ) */
    .quick-nav{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin:12px 0 0}
    .qnav-item{ display:flex;align-items:center;gap:10px;padding:12px;border:1px solid var(--border);
      border-radius:14px;background:var(--card);box-shadow:var(--shadow);color:var(--text);text-decoration:none }
    .qnav-item img{width:28px;height:28px;border-radius:8px}
    .metrics{margin:16px 0 8px}
    .metrics-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
    .metric{display:flex;align-items:center;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--card);box-shadow:var(--shadow)}
    .metric svg{width:22px;height:22px}
    .metric span{color:var(--muted);font-size:13px}
  </style>

  <!-- 1) GA4 -->
  <script defer src="/assets/analytics.js"></script>
  <!-- (bỏ renderer ngoài để dùng renderer nội bộ gọn/đồng nhất) -->
  <!-- <script defer src="/assets/js/render-products.js"></script> -->
  <!-- 3) Affiliate -->
  <script defer src="/assets/mxd-affiliate.js"></script>

  <!-- JSON-LD Organization -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Organization","name":"MXD","url":"https://mxd210.github.io/","logo":"https://mxd210.github.io/assets/img/og/home.webp","sameAs":["https://www.facebook.com/mxd6686"],"contactPoint":[{"@type":"ContactPoint","telephone":"+84-338-328-898","contactType":"customer service","areaServed":"VN","availableLanguage":["vi","en"]}]}
  </script>
  <script defer src="/assets/js/floating-contact.js?v=2025-09-26-1"></script>
</head>
<body>
  <!-- Header -->
  <header style="position:sticky;top:0;z-index:50;background:var(--bg);backdrop-filter:blur(6px)">
    <div class="container" style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;padding:12px 16px;border-bottom:1px solid var(--border)">
      <a href="/" class="brand" style="font-weight:900;font-size:20px;color:var(--text);text-decoration:none">MXD</a>
      <nav class="site-nav">
        <a href="/" class="nav-link" aria-current="page">Trang chủ</a>
        <a href="/store.html" class="nav-link">Cửa hàng</a>
        <a href="/blog/" class="nav-link">Tin tức</a>
        <a href="/tu-van.html" class="nav-link">Tư vấn</a>
        <a href="/cong-cu/" class="nav-link">Công cụ</a>
        <a href="/lien-he.html" class="nav-link">Liên hệ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO -->
    <section class="hero" aria-label="Hero" id="hero">
      <div class="hero-inner">
        <h1>MXD — Trung tâm mua sắm đa ngành</h1>
        <p>Đầy đủ công cụ thi công, phụ kiện, thời trang & đồ gia dụng, Đồ Điện tử.</p>
        <a class="cta" href="/store.html" aria-label="Xem Cửa hàng">Khám phá cửa hàng
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M5 12h12M13 5l7 7-7 7"/></svg>
        </a>
      </div>
    </section>
    <script>
      (function(){ const hero=document.getElementById('hero'); const img=new Image();
        img.onerror=()=>hero.classList.add('hero-fallback'); img.src='/assets/img/hero/home-hero.webp'; })();
    </script>

    <!-- METRICS -->
    <section class="metrics" aria-label="Chỉ số dịch vụ">
      <div class="metrics-grid">
        <div class="metric"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 12l7 7 11-11"/></svg><div><strong>Miễn phí vận chuyển</strong><span>tuỳ chính sách nhà bán</span></div></div>
        <div class="metric"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l4 8H8l4-8zm0 18a2 2 0 100-4 2 2 0 000 4z"/></svg><div><strong>Giao nhanh</strong><span>ưu tiên hàng nội địa</span></div></div>
        <div class="metric"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1l3 7h7l-6 4 2 7-6-4-6 4 2-7-6-4h7z"/></svg><div><strong>Hàng chọn lọc</strong><span>đáng tiền – dễ mua</span></div></div>
        <div class="metric"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M5 4h14v14H5zM9 8h6v6H9z"/></svg><div><strong>Bảo hành</strong><span>theo chính sách từng hãng</span></div></div>
      </div>
    </section>

    <!-- QUICK-NAV -->
    <section aria-label="Danh mục nhanh" style="margin-top:12px">
      <ul class="quick-nav" id="quick-nav">
        <li><a href="/store/noi-bat.html" class="qnav-item"><img src="/assets/img/categories/noi-bat.webp" alt="Sản phẩm nổi bật — MXD" width="28" height="28" onerror="this.src='/assets/img/categories/placeholder.webp'"> Sản phẩm nổi bật</a></li>
        <li><a href="/store/may-moc-xay-dung.html" class="qnav-item"><img src="/assets/img/categories/may-moc-xay-dung.webp" alt="Máy móc xây dựng — MXD" width="28" height="28" onerror="this.src='/assets/img/categories/placeholder.webp'"> Máy móc xây dựng</a></li>
        <li><a href="/store/thoi-trang.html" class="qnav-item"><img src="/assets/img/categories/thoi-trang.webp" alt="Thời trang — MXD" width="28" height="28" onerror="this.src='/assets/img/categories/placeholder.webp'"> Thời trang</a></li>
        <li><a href="/store/do-dien-tu.html" class="qnav-item"><img src="/assets/img/categories/do-dien-tu.webp" alt="Đồ điện tử — MXD" width="28" height="28" onerror="this.src='/assets/img/categories/placeholder.webp'"> Đồ điện tử</a></li>
        <li><a href="/store/my-pham.html" class="qnav-item"><img src="/assets/img/categories/my-pham.webp" alt="Mỹ phẩm — MXD" width="28" height="28" onerror="this.src='/assets/img/categories/placeholder.webp'"> Mỹ phẩm</a></li>
      </ul>
    </section>

    <!-- SẢN PHẨM -->
    <h2 style="margin:16px 0 0">Sản phẩm mới</h2>
    <div id="product-list" class="grid compact" aria-live="polite"></div>
    <p id="empty" class="muted" style="display:none">Chưa có sản phẩm. Hãy thêm <code>/assets/data/affiliates.json</code> hoặc <code>/products.json</code>.</p>
    <noscript>Trang cần JavaScript để hiển thị danh sách sản phẩm.</noscript>

    <!-- MỚI CẬP NHẬT -->
    <h2 style="margin:24px 0 0">Mới cập nhật</h2>
    <div id="updated-list" class="grid compact" aria-live="polite"></div>
    <p id="updated-empty" class="muted" style="display:none">Chưa có sản phẩm mới cập nhật.</p>
  </main>

  <footer>
    <div class="container">© MXD · <a href="/chinh-sach/bao-mat.html">Bảo mật</a> · <a href="/chinh-sach/doi-tra.html">Đổi trả</a> · <a href="/chinh-sach/bao-hanh.html">Bảo hành</a></div>
  </footer>

  <!-- Config -->
  <script>
    window.MXD_RENDER = { source:'/assets/data/affiliates.json', limit:30 };
  </script>

  <!-- COMPACT RENDER (home) -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const wrap = document.querySelector('#product-list');
      const empty = document.getElementById('empty');

      const fmt = n => isFinite(+n) ? new Intl.NumberFormat('vi-VN').format(+n)+'₫' : '';
      const esc = s => String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      const ensureAbs = (u) => {
        if(!u) return '#';
        const s = String(u).trim();
        if(/^https?:\/\//i.test(s)) return s;
        if(s.startsWith('//')) return 'https:'+s;
        if(/^[a-z0-9.-]+\.[a-z]{2,}/i.test(s)) return 'https://'+s.replace(/^\/+/,'');
        return s;
      };
      const inferM = (link, fallback) => {
        const h=(link||'').toLowerCase();
        if(h.includes('shopee')) return 'shopee';
        if(h.includes('lazada')) return 'lazada';
        if(h.includes('tiki')) return 'tiki';
        if(h.includes('tiktok')) return 'tiktok';
        return (fallback||'').toLowerCase()||'other';
      };
      const LABEL = {shopee:'Mua Shopee',lazada:'Mua Lazada',tiki:'Mua Tiki',tiktok:'Mua TikTok',other:'Mua ngay'};

      function salePct(price, oldPrice){
        if(!(isFinite(+price)&&isFinite(+oldPrice))) return null;
        if(+oldPrice <= +price) return null;
        return Math.round((1 - (+price/+oldPrice))*100);
      }

      function cardHTML(p){
        const sku = (p.sku||'').toLowerCase();
        const name = p.name || sku || 'Sản phẩm';
        const img  = esc(p.image || `/assets/img/products/${sku}.webp`);
        const link = ensureAbs(p.deeplink || p.origin_url || p.origin || p.url || p.link || '#');
        const m    = inferM(link, p.merchant);
        const price = (p.price!=null) ? fmt(p.price) : '';
        const old   = (p.old_price||p.price_old||p.list_price||p.msrp);
        const pct   = salePct(p.price, old);
        const btn   = LABEL[m] || 'Mua ngay';
        const detail= `/g.html?sku=${encodeURIComponent(sku)}`;

        return `
        <article class="card" data-sku="${esc(sku)}">
          <a class="thumb aspect-4-5" href="${detail}" aria-label="Xem chi tiết ${esc(name)}">
            ${pct?`<span class="sale-badge">-${pct}%</span>`:''}
            <span class="m-badge">${m==='other'?'Shop':m[0].toUpperCase()+m.slice(1)}</span>
            <img loading="lazy" decoding="async"
                 src="${img}" alt="${esc(name)}"
                 onerror="this.onerror=null;this.src='/assets/img/products/placeholder.webp'">
          </a>
          <div class="body">
            <h3 class="name"><a href="${detail}">${esc(name)}</a></h3>
            ${price?`<div class="price" data-price="${esc(p.price)}">${price}${(pct&&old)?` <del class="muted" style="margin-left:6px">${fmt(old)}</del>`:''}</div>`:''}
            <div class="actions">
              <a class="buy" data-merchant="${esc(m)}" href="${esc(link)}" target="_blank" rel="nofollow sponsored noopener">${esc(btn)}</a>
            </div>
          </div>
        </article>`;
      }

      // Load products
      fetch('/assets/data/affiliates.json', { cache:'no-store' })
        .then(r=>r.ok?r.json():[])
        .then(all=>{
          const arr = Array.isArray(all) ? all : (all.items||[]);
          if(!arr.length){ empty.style.display='block'; wrap.innerHTML=''; return; }
          const LIMIT = window.MXD_RENDER?.limit || 30;
          wrap.innerHTML = arr.slice(0, LIMIT).map(cardHTML).join('');
          if (window.mxdAffiliate?.scan) window.mxdAffiliate.scan();
        })
        .catch(()=>{ empty.style.display='block'; wrap.innerHTML=''; });

      // DEDUPE floating contacts nếu bị inject nhiều
      const fcs = document.querySelectorAll('#floating-contacts,.floating-contacts,.fc');
      if (fcs.length > 1) fcs.forEach((el,i)=> i>0 && el.remove());
    });
  </script>

  <!-- Dải MỚI CẬP NHẬT + JSON-LD ItemList -->
  <script>
    (function(){
      const updatedWrap = document.getElementById('updated-list');
      const updatedEmpty= document.getElementById('updated-empty');
      if (!updatedWrap) return;

      const money = n => Number.isFinite(+n) ? new Intl.NumberFormat('vi-VN').format(+n) + '₫' : '';
      const esc   = s => String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      const abs   = (u)=>{ if(!u) return ''; try{ const url=new URL(u,location.origin); if(url.origin===location.origin && u.startsWith('/')) return 'https://mxd210.github.io'+u; return url.href }catch{return ''} };
      const parseDate = s => { const t=Date.parse(s); return isNaN(t)?null:t };

      function render(list){
        if(!list.length){ updatedEmpty.style.display='block'; updatedWrap.innerHTML=''; return; }
        updatedWrap.innerHTML = list.map(p=>{
          const sku=(p.sku||'').toLowerCase();
          const name=p.name||sku||'Sản phẩm';
          const buy =p.deeplink||p.origin||'#';
          const img =p.image||`/assets/img/products/${sku}.webp`;
          const pct =(p.old_price&&p.price)? Math.round((1-(+p.price/+p.old_price))*100):null;
          const m = (buy.toLowerCase().includes('shopee')?'shopee':buy.toLowerCase().includes('lazada')?'lazada':buy.toLowerCase().includes('tiki')?'tiki':buy.toLowerCase().includes('tiktok')?'tiktok':'other');
          const btn = m==='shopee'?'Mua Shopee':m==='lazada'?'Mua Lazada':m==='tiki'?'Mua Tiki':m==='tiktok'?'Mua TikTok':'Mua ngay';
          return `
            <article class="card">
              <a class="thumb aspect-4-5" href="/g.html?sku=${encodeURIComponent(sku)}" aria-label="Xem chi tiết ${esc(name)}">
                ${pct?`<span class="sale-badge">-${pct}%</span>`:''}
                <span class="m-badge">${m==='other'?'Shop':m[0].toUpperCase()+m.slice(1)}</span>
                <img loading="lazy" decoding="async" src="${esc(img)}" alt="${esc(name)}" onerror="this.onerror=null;this.src='/assets/img/products/placeholder.webp'">
              </a>
              <div class="body">
                <h3 class="name"><a href="/g.html?sku=${encodeURIComponent(sku)}">${esc(name)}</a></h3>
                ${Number.isFinite(+p.price)?`<div class="price">${money(+p.price)}${p.old_price?` <del class="muted" style="margin-left:6px">${money(+p.old_price)}</del>`:''}</div>`:''}
                <div class="actions"><a class="buy" data-merchant="${m}" href="${esc(buy)}" target="_blank" rel="nofollow sponsored noopener">${btn}</a></div>
              </div>
            </article>`;
        }).join('');
        if (window.mxdAffiliate?.scan) window.mxdAffiliate.scan();
      }

      function injectJSONLD(list){
        if(!list.length) return;
        const itemList = {
          "@context":"https://schema.org","@type":"ItemList","name":"Mới cập nhật — MXD","url":"https://mxd210.github.io/",
          "itemListElement": list.map((p,i) => {
            const url = p.deeplink || p.origin || 'https://mxd210.github.io/';
            const product = {"@type":"Product","name": p.name || p.sku || "Sản phẩm","image": abs(p.image || `/assets/img/products/${(p.sku||'').toLowerCase()}.webp`),"url": url};
            if (Number.isFinite(+p.price)) product.offers = {"@type":"Offer","priceCurrency":"VND","price": String(+p.price),"availability":"https://schema.org/InStock","url": url};
            if (p.brand) product.brand = { "@type":"Brand", "name": String(p.brand) };
            return { "@type":"ListItem", "position": i+1, "url": url, "item": product };
          })
        };
        const tag=document.createElement('script'); tag.type='application/ld+json'; tag.textContent=JSON.stringify(itemList); document.head.appendChild(tag);
      }

      fetch('/products.json', { cache:'no-store' })
        .then(r=>r.ok?r.json():[])
        .then(all=>{
          const list=(Array.isArray(all)?all:[]).filter(p=>p && p.status && parseDate(p.updated_at));
          list.sort((a,b)=>parseDate(b.updated_at)-parseDate(a.updated_at));
          const top=list.slice(0,8);
          render(top);
          injectJSONLD(top);
        })
        .catch(()=>{ updatedEmpty.style.display='block'; updatedWrap.innerHTML=''; });
    })();
  </script>

  <!-- SW -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js',{updateViaCache:'none'})
        .then(reg=>{ if(reg.waiting) reg.waiting.postMessage('SKIP_WAITING');
          reg.addEventListener('updatefound',()=>{ const nw=reg.installing; nw&&nw.addEventListener('statechange',()=>{ if(nw.state==='installed'&&navigator.serviceWorker.controller){ reg.waiting&&reg.waiting.postMessage('SKIP_WAITING'); } }); });
        });
      navigator.serviceWorker.addEventListener('controllerchange',()=>location.reload());
    }
  </script>

  <script defer src="/assets/js/floating-contact.js"></script>
</body>
</html>
<!-- /FILE -->
