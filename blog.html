<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telephone=no" />

  <title>Chia s·∫ª kinh nghi·ªám thi c√¥ng & ch·ªçn s·∫£n ph·∫©m | MXD</title>
  <meta name="description" content="Kinh nghi·ªám th·ª±c chi·∫øn: ch·ªëng th·∫•m, ·ªëp l√°t, ch·ªçn thi·∫øt b·ªã, t·ªëi ∆∞u chi ph√≠. B√†i vi·∫øt ng·∫Øn, d·ªÖ hi·ªÉu d√†nh cho th·ª£ x√¢y d·ª±ng, k·ªπ s∆∞ & ng∆∞·ªùi l√†m nh√†.">
  <meta name="robots" content="index, follow">

  <!-- Canonical & PWA -->
  <link rel="canonical" href="https://mxd210.github.io/blog.html" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#111111" />

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Chia s·∫ª kinh nghi·ªám thi c√¥ng & ch·ªçn s·∫£n ph·∫©m | MXD">
  <meta property="og:description" content="Ch·ªëng th·∫•m, ·ªëp l√°t, d·ª•ng c·ª•, keo d√°n g·∫°ch‚Ä¶ t·ªïng h·ª£p th·ª±c chi·∫øn.">
  <meta property="og:url" content="https://mxd210.github.io/blog.html">

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/site.css" />
</head>
<body>
<header class="mxd-header">
  <div class="wrap">
    <a class="brand" href="/">MXD</a>
    <nav class="menu">
      <a href="/">Trang ch·ªß</a>
      <a href="/store.html">C·ª≠a h√†ng</a>
      <a href="/tu-van.html">T∆∞ v·∫•n</a>
      <a href="/blog.html" aria-current="page">Blog</a>
    </nav>
  </div>
</header>

<main class="mxd-section">
  <div class="wrap">
    <!-- Hero -->
    <section class="hero" style="margin-bottom:16px">
      <h1 style="display:flex;gap:10px;align-items:center">
        <span style="font-size:1.6rem">üß±</span>
        <span>Chia s·∫ª kinh nghi·ªám thi c√¥ng & ch·ªçn s·∫£n ph·∫©m</span>
      </h1>
      <p class="lead">C√°c b√†i vi·∫øt h·ªØu √≠ch d√†nh cho th·ª£ x√¢y d·ª±ng, k·ªπ s∆∞ & ng∆∞·ªùi l√†m nh√†.</p>
    </section>

    <!-- Blog cards (auto from sitemap) -->
    <section aria-label="B√†i vi·∫øt m·ªõi">
      <ul class="cards" id="postList">
        <li class="card sk">
          <div class="sk-thumb"></div>
          <div class="card-body">
            <h3 class="sk-line" style="width:70%"></h3>
            <p class="sk-line" style="width:90%"></p>
            <div class="meta"><span class="chip">ƒêang t·∫£i‚Ä¶</span></div>
          </div>
        </li>
      </ul>
    </section>
  </div>
</main>

<footer class="mxd-footer"><div class="wrap">¬© MXD</div></footer>

<!-- Scripts (GA4 tr∆∞·ªõc affiliate theo MXD conventions) -->
<script src="/assets/analytics.js" defer></script>
<script src="/assets/mxd-affiliate.js" defer></script>
<script src="/js/floating-contact.js" defer></script>

<!-- JSON-LD: CollectionPage (s·ª≠a c√∫ ph√°p type) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Chia s·∫ª kinh nghi·ªám thi c√¥ng & ch·ªçn s·∫£n ph·∫©m | MXD",
  "url": "https://mxd210.github.io/blog.html"
}
</script>

<!-- Auto index logic -->
<script>
(async () => {
  // Bump query ƒë·ªÉ v∆∞·ª£t cache SW khi c·∫ßn
  const VERSION = '2025-09-27-01';
  const SITEMAP_URL = '/sitemap-blog.xml?v=' + VERSION;
  const listEl = document.getElementById('postList');
  const parser = new DOMParser();

  const esc = s => (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const fmtVN = d => isNaN(d) ? '' : d.toLocaleDateString('vi-VN');

  const pillFromUrl = (u) => {
    const p = u.split('/').pop() || '';
    if (p.includes('may-')) return 'M√°y m√≥c';
    if (p.includes('keo') || p.includes('gach') || p.includes('vat-lieu')) return 'V·∫≠t li·ªáu';
    if (p.includes('chong-tham')) return 'Ch·ªëng th·∫•m';
    if (p.includes('dung-cu')) return 'D·ª•ng c·ª•';
    if (p.includes('thi-cong') || p.includes('checklist')) return 'Thi c√¥ng';
    return 'T∆∞ v·∫•n';
  };

  const pickArticleLD = (blocks) => {
    for (const b of blocks) {
      if (!b) continue;
      if (Array.isArray(b)) {
        const item = b.find(x => x && (x['@type']==='Article' || (Array.isArray(x['@type']) && x['@type'].includes('Article'))));
        if (item) return item;
      } else if (typeof b==='object') {
        if (b['@type']==='Article' || (Array.isArray(b['@type']) && b['@type'].includes('Article'))) return b;
        if (b['@graph']) {
          const g = b['@graph'].find(x => x && (x['@type']==='Article' || (Array.isArray(x['@type']) && x['@type'].includes('Article'))));
          if (g) return g;
        }
      }
    }
    return null;
  };

  const extractMeta = (doc, url) => {
    const ogTitle = doc.querySelector('meta[property="og:title"]')?.content;
    const title = ogTitle || doc.querySelector('title')?.textContent || doc.querySelector('h1')?.textContent || url;

    const desc = doc.querySelector('meta[name="description"]')?.content
              || doc.querySelector('meta[property="og:description"]')?.content || '';

    let img = doc.querySelector('meta[property="og:image"]')?.content
           || doc.querySelector('header img')?.getAttribute('src')
           || '/assets/img/blog/placeholder.webp';

    // Chu·∫©n h√≥a ·∫£nh v·ªÅ absolute cho an to√†n t·∫£i
    if (img.startsWith('/')) img = location.origin + img;

    const blocks = Array.from(doc.querySelectorAll('script[type="application/ld+json"]')).map(s => {
      try { return JSON.parse(s.textContent.trim()); } catch { return null; }
    });

    const art = pickArticleLD(blocks);
    let dateISO = art?.datePublished || art?.dateModified
               || doc.querySelector('time[datetime]')?.getAttribute('datetime')
               || doc.querySelector('meta[property="article:published_time"]')?.content || '';

    const date = dateISO ? new Date(dateISO) : new Date(0);

    return {
      url,
      title: title.trim(),
      desc: (desc||'').trim(),
      img,
      pill: pillFromUrl(url),
      dateISO,
      date
    };
  };

  try {
    // 1) L·∫•y sitemap & r√∫t URLs
    const sm = await fetch(SITEMAP_URL, { cache: 'no-store' });
    const xmlText = await sm.text();
    const xml = parser.parseFromString(xmlText, 'application/xml');
    const urls = Array.from(xml.querySelectorAll('url > loc')).map(n => n.textContent.trim())
      .filter(u => u.includes('/blog/') && u.endsWith('.html'));

    if (!urls.length) {
      listEl.innerHTML = '<li>Ch∆∞a c√≥ b√†i n√†o trong sitemap-blog.xml</li>';
      return;
    }

    // 2) T·∫£i b√†i song song nh√≥m nh·ªè ƒë·ªÉ nh·∫π m√°y
    const concurrency = 4;
    const posts = [];
    for (let i = 0; i < urls.length; i += concurrency) {
      const part = urls.slice(i, i+concurrency);
      const got = await Promise.all(part.map(async (u) => {
        try {
          const res = await fetch(u + '?v=' + VERSION, { cache: 'no-store' });
          const text = await res.text();
          const doc = parser.parseFromString(text, 'text/html');
          return extractMeta(doc, u);
        } catch (e) {
          console.warn('[blog] fetch fail:', u, e);
          return null;
        }
      }));
      posts.push(...got.filter(Boolean));
    }

    // 3) S·∫Øp x·∫øp m·ªõi ‚Üí c≈©
    posts.sort((a,b) => b.date - a.date);

    // 4) Render
    listEl.innerHTML = '';
    const frag = document.createDocumentFragment();
    for (const p of posts) {
      const li = document.createElement('li');
      const pathname = new URL(p.url).pathname;
      li.innerHTML = `
        <a class="card" href="${esc(pathname)}">
          <img src="${esc(p.img)}" alt="${esc(p.title)}" width="1280" height="720" loading="lazy" decoding="async">
          <div class="card-body">
            <h3>${esc(p.title)}</h3>
            <p>${esc(p.desc)}</p>
            <div class="meta">
              ${p.dateISO ? `<time datetime="${esc(p.dateISO)}">${fmtVN(p.date)}</time>` : ''}
              <span class="chip">${esc(p.pill)}</span>
            </div>
          </div>
        </a>
      `.trim();
      frag.appendChild(li);
    }
    listEl.appendChild(frag);
  } catch (err) {
    console.error(err);
    listEl.innerHTML = '<li>L·ªói t·∫£i danh s√°ch b√†i vi·∫øt. Vui l√≤ng t·∫£i l·∫°i trang.</li>';
  }
})();
</script>

<!-- CSS tƒÉng c∆∞·ªùng cho th·∫ª blog (nh·∫π, g·∫Øn ngay t·∫°i trang n·∫øu ch∆∞a mu·ªën s·ª≠a site.css) -->
<style>
  .cards{list-style:none;margin:0;padding:0;display:grid;gap:20px;grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:960px){.cards{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.cards{grid-template-columns:1fr}}
  .card{display:block;background:#fff;color:inherit;text-decoration:none;overflow:hidden;border:1px solid #e9e9e9;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.04);transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease}
  .card:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.08);border-color:#ddd}
  .card>img{width:100%;height:auto;aspect-ratio:16/9;object-fit:cover;display:block}
  .card-body{padding:14px 16px 16px}
  .card-body h3{margin:4px 0 8px;font-size:1.05rem;line-height:1.35}
  .card-body p{margin:0 0 10px;color:#444}
  .meta{display:flex;gap:8px;align-items:center;font-size:.9rem;color:#666;flex-wrap:wrap}
  .meta .chip{border:1px solid #e3e3e3;border-radius:999px;padding:2px 10px;font-size:.8rem;background:#fafafa}
  /* skeleton */
  .sk{border-style:dashed}
  .sk-thumb{width:100%;aspect-ratio:16/9;background:linear-gradient(90deg,#eee,#f6f6f6,#eee);animation:sk 1.2s infinite}
  .sk-line{height:14px;background:#eee;border-radius:6px;animation:sk 1.2s infinite}
  @keyframes sk{0%{background-position:0 0}100%{background-position:200% 0}}
</style>
</body>
</html>
