<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Máy cắt | MXD</title>
  <meta name="description" content="Danh mục Máy cắt: cưa đĩa, cưa kiếm, cưa lọng, bàn cắt, cut-off, circular, jigsaw, reciprocating… Hàng tin dùng thực tế từ MXD."/>
  <link rel="canonical" href="https://mxd210.github.io/store/may-cat.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- OG -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Máy cắt | MXD"/>
  <meta property="og:description" content="Cưa đĩa, cưa kiếm, cưa lọng, cut-off, circular, jigsaw, reciprocating…"/>
  <meta property="og:url" content="https://mxd210.github.io/store/may-cat.html"/>
  <meta property="og:image" content="https://mxd210.github.io/assets/img/categories/may-cat.webp"/>

  <!-- VERIFY (giữ nguyên nếu đang dùng) -->
  <meta name="google-site-verification" content="PASTE_GOOGLE_CODE">
  <meta name="msvalidate.01" content="PASTE_BING_CODE">

  <link rel="preload" as="image" href="/assets/img/categories/may-cat.webp"/>
  <link rel="stylesheet" href="/assets/site.css"/>

  <style>
    :root{
      --bg:#ffffff; --text:#111; --muted:#666; --border:#eaeaea; --card:#fff;
      --brand:#0a84ff; --brand-contrast:#fff; --radius:16px; --gap:16px;
      --shadow:0 6px 20px rgba(0,0,0,.06);
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0f1215; --text:#e8e8e8; --muted:#a2a2a2; --border:#262b31; --card:#14181d; --shadow:0 10px 28px rgba(0,0,0,.35) }
    }
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    header,footer{padding:12px 16px;border-bottom:1px solid var(--border)}
    footer{border-bottom:none;border-top:1px solid var(--border);margin-top:24px}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:var(--gap);margin:16px 0}
    .card{border:1px solid var(--border);border-radius:var(--radius);background:var(--card);overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow)}
    .card img{width:100%;height:240px;object-fit:cover;background:#f7f7f7}
    .card .body{padding:12px}
    .name{font-size:16px;line-height:1.35;margin:0 0 6px}
    .price{font-weight:800;margin:4px 0 10px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .buy{display:inline-block;border:1px solid var(--text);color:var(--text);border-radius:12px;padding:8px 10px}
    .buy:hover{background:var(--text);color:#fff}
    .muted{color:var(--muted)}
    .crumb{margin:0 0 6px}
    .hero{margin:10px 0 0}
    .hero img{width:100%;height:auto;border-radius:12px}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <p class="crumb"><a href="/">Trang chủ</a> › <a href="/store.html">Cửa hàng</a> › Máy cắt</p>
      <h1 style="margin:0">Danh mục: Máy cắt</h1>
      <p class="muted" style="margin:4px 0 0">
        Sản phẩm được lọc tự động từ <code>/affiliates.json</code> theo danh mục <code>may-cat</code>.
      </p>
      <figure class="hero">
        <img src="/assets/img/categories/may-cat.webp" alt="Máy cắt — MXD" width="1200" height="500" loading="eager" decoding="async"/>
      </figure>
    </div>
  </header>

  <main class="container">
    <div id="product-list" class="grid" aria-live="polite"></div>
    <p id="empty" class="muted" style="display:none">Chưa có sản phẩm phù hợp danh mục.</p>
    <noscript>Trang cần JavaScript để hiển thị danh sách sản phẩm.</noscript>
  </main>

  <footer>
    <div class="container">© MXD • Zalo/Phone 0338328898</div>
  </footer>

  <!-- GA4 trước, Affiliate sau (chỉ 1 lần theo chuẩn MXD) -->
  <script defer src="/assets/analytics.js"></script>
  <script defer src="/assets/mxd-affiliate.js"></script>
  <script defer src="/assets/js/floating-contact.js"></script>

  <script>
  // Chuẩn MXD
  const CATEGORY_SLUG = 'may-cat';
  const PLACEHOLDER = '/assets/img/products/placeholder.webp';
  const AFF_PATH = '/affiliates.json';

  const fmtVND = n => {
    const x = Number(n); if (!isFinite(x)) return '';
    try { return new Intl.NumberFormat('vi-VN').format(x) + '₫'; }
    catch { return (x+'').replace(/\B(?=(\d{3})+(?!\d))/g, ',') + '₫'; }
  };

  // Ưu tiên field category/categories; fallback regex (tên/SKU có “cắt”)
  function inCategory(p){
    if (p && (p.category === CATEGORY_SLUG)) return true;
    if (p && Array.isArray(p.categories) && p.categories.includes(CATEGORY_SLUG)) return true;
    const s = ((p.sku||'') + ' ' + (p.name||'')).toLowerCase();
    return /may[-\s_]*cat|cắt/.test(s);
  }

  function toLinks(p){
    if (Array.isArray(p.links) && p.links.length) return p.links;
    const origin = p.origin_url || p.origin || p.url || p.link;
    if (origin) return [{ merchant: (p.merchant||'origin'), href: origin }];
    return [];
  }

  function renderCard(p){
    const links = toLinks(p);
    const buyBtns = links.map(l =>
      `<a class="buy" href="${l.href}" data-merchant="${l.merchant||''}" target="_blank" rel="nofollow sponsored noopener">Mua ngay</a>`
    ).join('');
    const sku = (p.sku||'').toLowerCase();
    const name = p.name || sku || 'Sản phẩm';

    return `
      <article class="card">
        <!-- Meta link chuẩn MXD để affiliate.js nhận diện -->
        <a class="product-meta sr-only"
           href="${(p.origin_url || p.origin || p.url || p.link) || '#'}"
           data-merchant="${(p.merchant||'')}"
           data-sku="${sku}"
           data-img="/assets/img/products/${sku}.webp"
           ${p.price ? `data-price="${p.price}"` : ''}>${name}</a>

        <a href="/g.html?sku=${encodeURIComponent(sku)}" aria-label="Xem chi tiết ${name}">
          <img loading="lazy" decoding="async" width="640" height="640"
               src="/assets/img/products/${sku}.webp"
               alt="${name}"
               onerror="this.onerror=null;this.src='${PLACEHOLDER}'">
        </a>

        <div class="body">
          <h3 class="name"><a href="/g.html?sku=${encodeURIComponent(sku)}">${name}</a></h3>
          ${p.price ? `<div class="price" data-price="${p.price}">${fmtVND(p.price)}</div>` : ''}
          <div class="actions">${buyBtns}</div>
        </div>
      </article>
    `;
  }

  // Skeleton
  (function showSkeleton(){
    const wrap = document.getElementById('product-list');
    wrap.innerHTML = Array.from({length:6}).map(()=>`
      <article class="card">
        <div style="height:240px;background:linear-gradient(90deg, rgba(0,0,0,.06) 25%, rgba(0,0,0,.12) 37%, rgba(0,0,0,.06) 63%);"></div>
        <div class="body">
          <div style="height:18px;background:#eaeaea"></div>
          <div style="height:16px;width:40%;margin-top:8px;background:#eee"></div>
        </div>
      </article>
    `).join('');
  })();

  fetch(AFF_PATH, { cache: 'no-store' })
    .then(r=>r.ok?r.json():[])
    .then(all=>{
      const arr = Array.isArray(all) ? all : (all.items||[]);
      const list = arr.filter(inCategory);
      const wrap = document.getElementById('product-list');
      const empty = document.getElementById('empty');

      if (!list.length){
        empty.style.display='block'; wrap.innerHTML=''; return;
      }

      // Sắp xếp tăng dần theo giá (có giá đứng trước)
      list.sort((a,b)=>(a.price||1e15)-(b.price||1e15));
      wrap.innerHTML = list.map(renderCard).join('');

      // JSON-LD ItemList
      const ld = {"@context":"https://schema.org","@type":"ItemList",
        "itemListElement": list.map((p,i)=>({"@type":"ListItem","position":i+1,"name":p.name||p.sku,"url":`/g.html?sku=${(p.sku||'').toLowerCase()}`}))};
      const s = document.createElement('script'); s.type='application/ld+json'; s.textContent=JSON.stringify(ld); document.head.appendChild(s);

      // Kích hoạt affiliate rewrite
      if (window.mxdAffiliate?.scan) window.mxdAffiliate.scan();
    })
    .catch(err=>{
      console.error('Không thể tải affiliates.json', err);
      document.getElementById('empty').style.display='block';
    });
  </script>
</body>
</html>
