<!-- REPLACE WHOLE FILE: /store/may-moc-xay-dung.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Máy móc xây dựng – Thiết bị chọn lọc | MXD210</title>
  <meta name="description" content="Máy móc, thiết bị phục vụ thi công và sửa chữa nhỏ: máy khoan, máy cắt, máy rung bê tông, máy ốp lát, bàn đẩy… được MXD210 chọn theo tiêu chí: dễ mua, dễ bảo hành, phù hợp với nhu cầu thực tế ngoài công trình.">
  <link rel="canonical" href="https://mxd210.github.io/store/may-moc-xay-dung.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- OPEN GRAPH -->
  <meta property="og:title" content="Máy móc xây dựng – Thiết bị chọn lọc | MXD210"/>
  <meta property="og:description" content="Gợi ý máy móc, thiết bị xây dựng: máy khoan, máy cắt, máy rung, máy ốp lát, bàn đẩy… ưu tiên những mẫu phù hợp thợ thi công, chủ nhà tự xử lý các hạng mục nhỏ."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://mxd210.github.io/store/may-moc-xay-dung.html"/>

  <link rel="stylesheet" href="/assets/site.css"/>

  <!-- Analytics trước Affiliate -->
  <script defer src="/assets/analytics.js"></script>
  <script defer src="/assets/mxd-affiliate.js"></script>
  <script defer src="/assets/mxd-store.v2.js"></script>

  <!-- Style nhỏ riêng cho nút lọc -->
  <style>
    .category-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }
    .category-info span[data-category-count] {
      margin-left: 0.35rem;
      color: #666;
      font-size: 0.9rem;
    }
    .category-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .filter-btn {
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 0.25rem 0.7rem;
      font-size: 0.9rem;
      background: #fafafa;
      cursor: pointer;
      white-space: nowrap;
    }
    .filter-btn.is-active {
      border-color: #ff9800;
      background: #ffe0b2;
      font-weight: 600;
    }
    .filter-btn:hover {
      background: #ffe7c2;
    }
    .category-note {
      margin: 0.75rem 0 0.5rem;
      font-size: 0.92rem;
      color: #555;
    }
  </style>
</head>
<body data-nav="store">
  <header class="site-header">
    <div class="container">
      <a href="/" class="logo">
        <span class="logo-main">MXD210</span>
        <span class="logo-sub">Xây dựng &amp; Affiliate</span>
      </a>

      <nav class="main-nav">
        <ul>
          <li><a href="/" data-nav="home">Trang chủ</a></li>
          <li><a href="/store.html" data-nav="store">Cửa hàng</a></li>
          <li><a href="/blog-xay-dung.html" data-nav="blog-xd">Góc xây dựng</a></li>
          <li><a href="/mxd-aff-academy.html" data-nav="aff-academy">Góc Affiliate</a></li>
          <li><a href="/contact.html" data-nav="contact">Liên hệ</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="page-main">
    <section class="category-hero">
      <div class="container">
        <h1>Máy móc &amp; thiết bị cho anh em hiện trường</h1>
        <p>
          Những món phục vụ trực tiếp cho thi công, sửa chữa: máy khoan, máy cắt, máy rung bê tông,
          máy ốp lát, bàn đẩy, thiết bị đo, phụ kiện đi kèm… được chọn dựa trên kinh nghiệm thực tế ngoài công trình.
        </p>
      </div>
    </section>

    <section class="category-products container">
      <div class="category-toolbar">
        <div class="category-info">
          <strong>Máy móc xây dựng</strong>
          <span data-category-count></span>
        </div>

        <!-- 3 nút lọc + 1 nút Tất cả -->
        <div class="category-filters" aria-label="Lọc sản phẩm máy móc xây dựng">
          <button type="button" class="filter-btn is-active" data-filter="all">Tất cả</button>
          <button type="button" class="filter-btn" data-filter="hand">Dụng cụ cầm tay</button>
          <button type="button" class="filter-btn" data-filter="safe">Đồ bảo hộ lao động</button>
          <button type="button" class="filter-btn" data-filter="access">Phụ kiện máy</button>
        </div>
      </div>

      <div class="category-note">
        Bấm nút bên phải để lọc nhanh theo nhóm, mặc định đang hiển thị toàn bộ sản phẩm máy móc &amp; thiết bị liên quan.
      </div>

      <div class="product-grid" id="grid-may-moc-xd">
        <!-- JS sẽ render toàn bộ sản phẩm ở đây, sau đó nút lọc chỉ ẩn/hiện theo nhóm -->
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© MXD210 – Đồng hành cùng anh em ngoài công trình lẫn trong nhà.</p>
    </div>
  </footer>

  <script>
    (function () {
      'use strict';

      const GRID        = document.getElementById('grid-may-moc-xd');
      const COUNT_EL    = document.querySelector('[data-category-count]');
      const FILTER_BTNS = document.querySelectorAll('.filter-btn');

      if (!GRID) return;

      // Bất cứ category nào có những từ này thì coi là "máy móc & thiết bị"
      const MACHINE_REGEX = /(may|m\u00e1y|khoan|c\u01b0a|c\u1eaft|m\u00e0i|h\u00e0n|nen-khi|n\u00e9n-kh\u00ed|bom-nuoc|b\u01a1m-n\u01b0\u1edbc|dung-cu|d\u1ee5ng-c\u1ee5|bao-ho|b\u1ea3o-h\u1ed9|phu-kien-may|ph\u1ee5-ki\u1ec7n-m\u00e1y)/;

      function detectGroup(cat) {
        const c = (cat || '').toLowerCase();
        if (c.indexOf('bao-ho') !== -1 || c.indexOf('bảo-hộ') !== -1) return 'safe';
        if (c.indexOf('phu-kien-may') !== -1 || c.indexOf('phụ-kiện-máy') !== -1) return 'access';
        return 'hand';
      }

      const sources = [
        '/assets/data/affiliates.json',
        '/assets/data/products.json',
        '/products.json'
      ];

      function formatPrice(vnd) {
        if (vnd === undefined || vnd === null || vnd === '') return '';
        try {
          return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND',
            maximumFractionDigits: 0
          }).format(vnd);
        } catch (e) {
          return String(vnd).replace(/\B(?=(\d{3})+(?!\d))/g, '.') + '₫';
        }
      }

      function createCard(p) {
        const article = document.createElement('article');
        article.className = 'product-card';

        const safeUrl = p.origin_url || '#';
        const safeMerchant = (p.merchant || '').toLowerCase();
        const group = detectGroup(p.category || '');

        article.dataset.group = group;

        article.innerHTML = `
          <a href="${safeUrl}"
             class="product-link"
             data-merchant="${safeMerchant}">
            <div class="product-thumb">
              <img loading="lazy"
                   src="${p.image || '/assets/img/products/placeholder.webp'}"
                   alt="${p.name || 'Sản phẩm máy móc xây dựng'}">
            </div>
            <h3 class="product-title">${p.name || 'Sản phẩm chưa đặt tên'}</h3>
            ${p.price_vnd ? `<p class="product-price">${formatPrice(p.price_vnd)}</p>` : ''}
            <button class="product-buy-btn">Xem sản phẩm</button>
          </a>
        `;
        return article;
      }

      let allProducts = [];
      let currentFilter = 'all';

      function renderGrid() {
        GRID.innerHTML = '';

        const filtered = allProducts.filter(function (p) {
          if (currentFilter === 'all') return true;
          const g = detectGroup(p.category || '');
          return (
            (currentFilter === 'hand'   && g === 'hand') ||
            (currentFilter === 'safe'   && g === 'safe') ||
            (currentFilter === 'access' && g === 'access')
          );
        });

        if (COUNT_EL) {
          COUNT_EL.textContent = filtered.length ? `(${filtered.length} sản phẩm)` : '(0 sản phẩm)';
        }

        if (!filtered.length) {
          GRID.innerHTML = '<p>Chưa có sản phẩm phù hợp với bộ lọc này.</p>';
          return;
        }

        filtered.forEach(function (p) {
          GRID.appendChild(createCard(p));
        });
      }

      async function loadData() {
        let data = null;

        for (const src of sources) {
          try {
            const res = await fetch(src, { cache: 'no-store' });
            if (!res.ok) continue;
            data = await res.json();
            if (data) break;
          } catch (e) {
            // thử source tiếp theo
          }
        }

        if (!data) {
          GRID.textContent = 'Không tải được dữ liệu sản phẩm. Thử lại sau.';
          return;
        }

        const list = Array.isArray(data) ? data : (data.products || []);

        // Lấy TẤT CẢ sản phẩm có category trông giống máy móc & thiết bị
        allProducts = list.filter(function (p) {
          const cat = (p && p.category) ? p.category.toString().toLowerCase() : '';
          return p
            && p.origin_url
            && (p.status !== false)
            && MACHINE_REGEX.test(cat);
        });

        renderGrid();
      }

      // Gắn sự kiện cho các nút lọc
      FILTER_BTNS.forEach(function (btn) {
        btn.addEventListener('click', function () {
          const f = btn.getAttribute('data-filter');
          if (!f || f === currentFilter) return;

          currentFilter = f;

          FILTER_BTNS.forEach(function (b) {
            b.classList.toggle('is-active', b === btn);
          });

          renderGrid();
        });
      });

      loadData();
    })();
  </script>
</body>
</html>
