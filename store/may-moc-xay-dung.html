<!-- REPLACE WHOLE FILE: /store/may-moc-xay-dung.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>Máy móc xây dựng – Thiết bị chọn lọc | MXD210</title>
  <meta name="description" content="Máy móc, thiết bị phục vụ thi công và sửa chữa nhỏ: máy khoan, máy cắt, máy rung bê tông, máy ốp lát, bàn đẩy… được MXD210 chọn theo tiêu chí: dễ mua, dễ bảo hành, phù hợp với nhu cầu thực tế ngoài công trình.">
  <link rel="canonical" href="https://mxd210.github.io/store/may-moc-xay-dung.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- OPEN GRAPH -->
  <meta property="og:title" content="Máy móc xây dựng – Thiết bị chọn lọc | MXD210"/>
  <meta property="og:description" content="Gợi ý máy móc, thiết bị xây dựng: máy khoan, máy cắt, máy rung, máy ốp lát, bàn đẩy… ưu tiên những mẫu phù hợp thợ thi công, chủ nhà tự xử lý các hạng mục nhỏ."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://mxd210.github.io/store/may-moc-xay-dung.html"/>

  <link rel="stylesheet" href="/assets/site.css"/>

  <!-- Analytics trước Affiliate -->
  <script defer src="/assets/analytics.js"></script>
  <script defer src="/assets/mxd-affiliate.js"></script>
  <!-- KHÔNG dùng mxd-store.v2.js nữa, render inline theo chuẩn mới -->

  <!-- Style nhỏ cho phần nút lọc -->
  <style>
    .category-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    .category-info span[data-category-count] {
      margin-left: 0.35rem;
      color: #666;
      font-size: 0.9rem;
    }
    .category-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .filter-btn {
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 0.25rem 0.7rem;
      font-size: 0.9rem;
      background: #fafafa;
      cursor: pointer;
      white-space: nowrap;
    }
    .filter-btn.is-active {
      border-color: #ff9800;
      background: #ffe0b2;
      font-weight: 600;
    }
    .filter-btn:hover {
      background: #ffe7c2;
    }
    .category-note {
      margin: 0.5rem 0 0.25rem;
      font-size: 0.9rem;
      color: #555;
    }
    .category-empty {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #666;
      display: none;
    }
  </style>
</head>
<body data-nav="store">
<header class="site-header">
  <div class="container">
    <a href="/" class="logo">
      <span class="logo-main">MXD210</span>
      <span class="logo-sub">Xây dựng &amp; Affiliate</span>
    </a>

    <nav class="main-nav">
      <ul>
        <li><a href="/" data-nav="home">Trang chủ</a></li>
        <li><a href="/store.html" data-nav="store">Cửa hàng</a></li>
        <li><a href="/blog-xay-dung.html" data-nav="blog-xd">Góc xây dựng</a></li>
        <li><a href="/mxd-aff-academy.html" data-nav="aff-academy">Góc Affiliate</a></li>
        <li><a href="/contact.html" data-nav="contact">Liên hệ</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="page-main">
  <section class="category-hero">
    <div class="container">
      <h1>Máy móc &amp; thiết bị cho anh em hiện trường</h1>
      <p>
        Những món phục vụ trực tiếp cho thi công, sửa chữa: máy khoan, máy cắt, máy rung bê tông,
        máy ốp lát, bàn đẩy, thiết bị đo, phụ kiện đi kèm… được chọn dựa trên kinh nghiệm thực tế ngoài công trình.
      </p>
    </div>
  </section>

  <section class="category-products container"
           data-mxd-category-page
           data-category="may-moc-xay-dung"
           data-category-alt="may-moc,may-duc,may-laze,may-lazer,may-khoan,may-ban-vit,may-vit,may-khoan-pin,may-duc-pin,may-thoi,may-thoi-la,maycat,may-mai,may-mai-goc,may-duc-hoi,may-rung,may-rung-be-tong,may-rung-betong,may-op-lat,may-cat-gach,may-cat-lat,may-ban-day,ban-day,may-day-tay,day-tay,phu-kien-may,do-bao-ho-lao-dong"
           data-limit="600"
           data-featured-first="true">

    <div class="category-toolbar">
      <div class="category-info">
        <strong>Máy móc xây dựng</strong>
        <span data-category-count></span>
      </div>

      <div class="category-filters" aria-label="Lọc sản phẩm máy móc xây dựng">
        <button type="button" class="filter-btn is-active" data-filter="all">Tất cả</button>
        <button type="button" class="filter-btn" data-filter="hand">Dụng cụ cầm tay</button>
        <button type="button" class="filter-btn" data-filter="safe">Đồ bảo hộ lao động</button>
        <button type="button" class="filter-btn" data-filter="access">Phụ kiện máy</button>
      </div>
    </div>

    <p class="category-note">
      Bấm nút bên phải để lọc nhanh theo nhóm. Mặc định hiển thị toàn bộ sản phẩm liên quan tới máy móc &amp; thiết bị.
    </p>

    <div class="product-grid"></div>
    <p class="category-empty" data-category-empty data-empty-msg>
      Chưa có sản phẩm phù hợp với bộ lọc này.
    </p>
  </section>
</main>

<footer class="site-footer">
  <div class="container">
    <p>© MXD210 – Đồng hành cùng anh em ngoài công trình lẫn trong nhà.</p>
  </div>
</footer>

<!-- MXD-CATEGORY-LOADER v2025-12-04c — loader dùng chung + hỗ trợ category-alt -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('[data-mxd-category-page]');
  if (!section) return;

  const grid        = section.querySelector('.product-grid');
  const countEl     = section.querySelector('[data-category-count]');
  const emptyEl     = section.querySelector('[data-category-empty]');
  const catSlug     = (section.getAttribute('data-category') || '').toString().toLowerCase();
  const catAltRaw   = (section.getAttribute('data-category-alt') || '').toString();
  const catAltList  = catAltRaw.split(',').map(s => s.trim().toLowerCase()).filter(Boolean);
  const limitRaw    = parseInt(section.getAttribute('data-limit') || '', 10);
  const limit       = Number.isFinite(limitRaw) ? limitRaw : 600;
  const featuredFirst = (section.getAttribute('data-featured-first') || '').toString() === 'true';

  if (!grid) return;

  const fmtPrice = n =>
    Number.isFinite(+n) ? new Intl.NumberFormat('vi-VN').format(+n) + '₫' : '';

  const escapeHTML = str => String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');

  const escapeAttr = str => escapeHTML(str).replace(/`/g, '&#96;');

  const normalizeOrigin = raw => {
    let u = (raw || '').toString().trim();
    if (!u) return '';
    if (u.startsWith('//')) u = 'https:' + u;
    if (!/^https?:\/\//i.test(u)) {
      u = 'https://' + u.replace(/^\/+/, '');
    }
    return u;
  };

  const detectMerchant = url => {
    try {
      if (!url) return '';
      const u = new URL(url.startsWith('http') ? url : 'https://' + url);
      const host = u.hostname.toLowerCase();
      if (host.includes('shopee'))    return 'shopee';
      if (host.includes('lazada'))    return 'lazada';
      if (host.includes('tiki'))      return 'tiki';
      if (host.includes('tiktok'))    return 'tiktok';
      if (host.includes('mediamart')) return 'mediamart';
      return '';
    } catch {
      return '';
    }
  };

  const merchantLabelFor = m => {
    switch (m) {
      case 'shopee':    return 'Shopee';
      case 'lazada':    return 'Lazada';
      case 'tiki':      return 'Tiki';
      case 'tiktok':    return 'TikTok Shop';
      case 'mediamart': return 'MediaMart';
      default:          return '';
    }
  };

  const getTime = val => {
    if (!val) return 0;
    const t = new Date(val).getTime();
    return Number.isFinite(t) ? t : 0;
  };

  const getPrice = p => {
    const v = p.price ?? p.price_vnd ?? p.price_vnd_int;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  };

  const matchesCategory = p => {
    if (!catSlug && !catAltList.length) return true;

    const cat = (p.category || '').toString().toLowerCase().trim();
    if (!cat) return false;

    const tokens = cat.split(/[,\s]+/);

    // match slug chính
    if (catSlug) {
      if (cat === catSlug) return true;
      if (tokens.includes(catSlug)) return true;
    }

    // match theo danh sách alt
    if (catAltList.length) {
      for (const key of catAltList) {
        if (!key) continue;
        if (cat === key) return true;
        if (tokens.includes(key)) return true;
      }
    }

    return false;
  };

  const renderCard = p => {
    const name      = escapeHTML(p.name || '');
    const sku       = escapeAttr(p.sku || '');
    const shortDesc = escapeHTML(
      (p.short_desc || p.description || p.name || '').toString().trim()
    );
    const priceVal  = getPrice(p);
    const priceText = priceVal != null ? escapeHTML(fmtPrice(priceVal)) : '';

    const originRaw = (p.origin || p.origin_url || '').toString().trim();
    const origin    = normalizeOrigin(originRaw) || '#';

    const merchantRaw   = (p.merchant || detectMerchant(origin)).toString().toLowerCase();
    const merchantLabel = merchantLabelFor(merchantRaw);

    const imgSrc = escapeAttr(
      p.image || `/assets/img/products/${encodeURIComponent(p.sku || 'placeholder')}.webp`
    );
    const detailHref = `/g.html?sku=${encodeURIComponent(p.sku || '')}`;

    let btnText = 'Mua ngay';
    if (merchantLabel) {
      btnText = (merchantRaw === 'mediamart'
        ? 'Mua ngay tại '
        : 'Mua ngay trên '
      ) + merchantLabel;
    }

    return `
      <article class="product-card"
               data-sku="${sku}"
               data-category="${escapeAttr(p.category || '')}">
        <a href="${detailHref}">
          <div class="thumb">
            <img src="${imgSrc}"
                 alt="${name}"
                 loading="lazy"
                 onerror="this.onerror=null;this.src='/assets/img/products/placeholder.webp';">
            <div class="product-hover">
              <p>${shortDesc}</p>
            </div>
          </div>
        </a>
        <div class="body">
          <div class="product-title title">
            <a href="${detailHref}">${name}</a>
          </div>
          <div class="price">${priceText}</div>
          <div class="actions">
            <a class="buy btn-buy"
               href="${escapeAttr(origin)}"
               data-merchant="${escapeAttr(merchantRaw)}"
               data-sku="${sku}"
               data-origin-url="${escapeAttr(origin)}">
              ${btnText}
            </a>
          </div>
        </div>
      </article>
    `;
  };

  // Skeleton đơn giản
  grid.innerHTML = Array.from({ length: 6 }).map(() => `
    <article class="product-card">
      <div class="thumb">
        <div class="skeleton" style="width:100%;height:200px;border-radius:12px"></div>
      </div>
      <div class="body">
        <div class="skeleton" style="height:18px;margin-bottom:8px"></div>
        <div class="skeleton" style="height:16px;width:40%;margin-bottom:8px"></div>
        <div class="skeleton" style="height:32px;width:60%;border-radius:999px"></div>
      </div>
    </article>
  `).join('');

  if (emptyEl) emptyEl.style.display = 'none';

  fetch('/assets/data/affiliates.json', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : [])
    .then(all => {
      let arr = Array.isArray(all) ? all : (all.items || []);
      if (!arr.length) {
        grid.innerHTML = '';
        if (emptyEl) emptyEl.style.display = 'block';
        if (countEl) countEl.textContent = '';
        return;
      }

      arr = arr.filter(p => {
        if (!p) return false;
        const status = (p.status || 'active').toString().toLowerCase();
        if (['archived', 'hidden', 'draft'].includes(status)) return false;
        return matchesCategory(p);
      });

      if (!arr.length) {
        grid.innerHTML = '';
        if (emptyEl) emptyEl.style.display = 'block';
        if (countEl) countEl.textContent = '0 sản phẩm';
        return;
      }

      // Sắp xếp: featured trước, rồi updated_at mới → cũ
      arr.sort((a, b) => {
        if (featuredFirst) {
          const fa = a.featured ? 1 : 0;
          const fb = b.featured ? 1 : 0;
          if (fb !== fa) return fb - fa;
        }
        const ta = getTime(a.updated_at);
        const tb = getTime(b.updated_at);
        return tb - ta;
      });

      const list = arr.slice(0, limit);

      grid.innerHTML = list.map(renderCard).join('');
      if (countEl) countEl.textContent = list.length + ' sản phẩm';

      // Cho affiliate scan để sinh deeplink isclix
      if (window.mxdAffiliate && typeof window.mxdAffiliate.scan === 'function') {
        try {
          window.mxdAffiliate.scan(grid);
        } catch (e) {
          console.error('mxdAffiliate.scan error (may-moc-xay-dung):', e);
        }
      }
    })
    .catch(err => {
      console.error('MXD category may-moc-xay-dung error:', err);
      grid.innerHTML = '';
      if (emptyEl) emptyEl.style.display = 'block';
      if (countEl) countEl.textContent = '';
    });
});
</script>

<!-- Script lọc sau khi loader đã render -->
<script>
(function(){
  'use strict';

  const section    = document.querySelector('[data-mxd-category-page]');
  if (!section) return;

  const grid       = section.querySelector('.product-grid');
  const countEl    = section.querySelector('[data-category-count]');
  const emptyEl    = section.querySelector('[data-empty-msg]');
  const filterBtns = section.querySelectorAll('.filter-btn');

  let currentFilter = 'all';

  function normalize(str){
    if (!str) return '';
    let s = str.toString().toLowerCase().trim();
    try {
      s = s.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    } catch(e){}
    s = s.replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
    return s;
  }

  function detectGroup(card){
    if (card.dataset.group) return card.dataset.group;

    const catRaw = card.getAttribute('data-category') || '';
    const title  = (card.querySelector('.product-title') || {}).textContent || '';
    const t      = title.toLowerCase();
    const cat    = normalize(catRaw);

    // mặc định coi là dụng cụ cầm tay
    let group = 'hand';

    // đồ bảo hộ
    if (
      cat.includes('bao-ho-lao-dong') ||
      t.includes('giay bao ho') || t.includes('giày bảo hộ') ||
      t.includes('gang tay')   || t.includes('găng tay')   ||
      t.includes('khau trang') || t.includes('khẩu trang') ||
      t.includes('mu bao ho')  || t.includes('mũ bao hộ')  ||
      t.includes('ao bao ho')  || t.includes('áo bảo hộ')  ||
      t.includes('ao phan quang') || t.includes('áo phản quang')
    ){
      group = 'safe';
    }

    // phụ kiện máy
    if (
      cat.includes('phu-kien-may') ||
      t.includes('da cat')   || t.includes('đá cắt') ||
      t.includes('luoi cua') || t.includes('lưỡi cưa') ||
      t.includes('mui khoan')|| t.includes('mũi khoan') ||
      t.includes('dia mai')  || t.includes('đĩa mài') ||
      t.includes('nham')     || t.includes('nhám')
    ){
      group = 'access';
    }

    card.dataset.group = group;
    return group;
  }

  function applyFilter(){
    const cards = Array.from(grid.children);
    let visible = 0;

    cards.forEach(function(card){
      const group = detectGroup(card);

      const show = (currentFilter === 'all') || (group === currentFilter);
      card.style.display = show ? '' : 'none';
      if (show) visible++;
    });

    if (countEl){
      countEl.textContent = visible ? '(' + visible + ' sản phẩm)' : '(0 sản phẩm)';
    }
    if (emptyEl){
      emptyEl.style.display = visible ? 'none' : 'block';
    }
  }

  // gắn click cho nút lọc
  filterBtns.forEach(function(btn){
    btn.addEventListener('click', function(){
      const f = btn.getAttribute('data-filter');
      if (!f || f === currentFilter) return;
      currentFilter = f;

      filterBtns.forEach(function(b){
        b.classList.toggle('is-active', b === btn);
      });

      applyFilter();
    });
  });

  // Quan sát khi loader render xong product-card
  const observer = new MutationObserver(function(mutations){
    let hasNew = false;
    mutations.forEach(function(m){
      if (m.addedNodes && m.addedNodes.length) hasNew = true;
    });
    if (hasNew){
      applyFilter();
    }
  });

  if (grid){
    observer.observe(grid, { childList: true });
  }

  // Phòng trường hợp product đã render sẵn trước khi observer gắn
  window.addEventListener('load', function(){
    applyFilter();
  });
})();
</script>
</body>
</html>
