<!-- MXD-CHECK v2025-10-07 [hub:/store/may-laze.html]
- Canonical tuyệt đối; robots=index,follow; meta verify OK
- GA4 (/assets/analytics.js) TRƯỚC /assets/mxd-affiliate.js
- OG: title/desc/url/image (≥1200×630 .webp) tuyệt đối
- product-grid: data-category="may-lazer" (nhận tên biến thể), data-sub cho anchor
- Không dán deeplink thủ công; dùng origin -> affiliate rewrite
-->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Máy cân bằng laser (5/12/16 tia) | MXD</title>
  <meta name="description" content="Máy cân bằng laser 5/12/16 tia, xanh/đỏ, tự cân bằng, điều khiển từ xa, phụ kiện tripod/receiver — chuẩn MXD, hiển thị gọn dễ mua."/>
  <link rel="canonical" href="https://mxd210.github.io/store/may-laze.html"/>
  <meta name="robots" content="index,follow"/>

  <!-- VERIFY -->
  <meta name="google-site-verification" content="84L0tRVs_wNPAyXii38-OaeGi8TyJdMlkZXVIHcnj0o"/>

  <!-- OG -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Máy cân bằng laser (5/12/16 tia) | MXD"/>
  <meta property="og:description" content="Máy laser 5/12/16 tia, xanh/đỏ; tự cân bằng, điều khiển từ xa; phụ kiện tripod/receiver."/>
  <meta property="og:url" content="https://mxd210.github.io/store/may-laze.html"/>
  <meta property="og:image" content="https://mxd210.github.io/assets/img/og/may-laze-og.webp"/>
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>

  <link rel="stylesheet" href="/assets/site.css"/>

  <!-- GA4 trước Affiliate -->
  <script defer src="/assets/analytics.js"></script>
  <!-- giữ để tương thích nếu nơi khác gọi -->
  <script defer src="/assets/js/render-products.js"></script>
  <script defer src="/assets/mxd-affiliate.js"></script>

  <style>
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .quick-nav{display:flex;gap:12px;flex-wrap:wrap;padding:8px 0;margin:8px 0 0}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border,#eaeaea);border-radius:12px;background:var(--card,#fff);text-decoration:none;box-shadow:0 6px 20px rgba(0,0,0,.06);color:inherit}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;margin:12px 0}
    /* Card + clamp: chống lộ chữ, nút luôn thẳng hàng */
    .product-card{display:flex;flex-direction:column;height:100%;border:1px solid var(--border,#eee);border-radius:12px;overflow:hidden;background:var(--card,#fff);box-shadow:0 6px 20px rgba(0,0,0,.04)}
    .product-card .thumb{display:block;aspect-ratio:1/1;overflow:hidden;background:#fafafa}
    .product-card img{width:100%;height:100%;object-fit:cover;display:block}
    .product-card .body{padding:10px 10px 12px;display:flex;flex-direction:column;gap:6px}
    .product-card h3{margin:0;font-size:14px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.7em}
    .product-card .price{font-weight:700}
    .product-card .actions{margin-top:auto}
    .product-card .btn{display:block;text-align:center;padding:8px 10px;border-radius:10px;background:#ff4d2d;color:#fff;text-decoration:none}
  </style>
</head>
<body>
  <header class="container">
    <nav class="breadcrumb" style="padding:12px 0;border-bottom:1px solid var(--border,#eaeaea);margin-bottom:8px">
      <a href="/">MXD</a> › <a href="/store.html">Cửa hàng</a> › <span>Máy cân bằng laser</span>
    </nav>
    <h1>Máy cân bằng laser <small>(5/12/16 tia)</small></h1>
    <p class="lead">Tuyển chọn theo số tia, môi trường thi công và phụ kiện. Dữ liệu từ affiliates chuẩn hóa hiển thị để dễ mua.</p>
  </header>

  <section class="container quick-nav">
    <a href="#laser-5-tia" class="chip">5 tia</a>
    <a href="#laser-12-tia" class="chip">12 tia</a>
    <a href="#laser-16-tia" class="chip">16 tia</a>
    <a href="#phu-kien-laser" class="chip">Phụ kiện (tripod, receiver…)</a>
    <a href="#faq" class="chip">FAQ</a>
  </section>

  <main class="container">
    <section id="laser-5-tia">
      <h2>Máy laser 5 tia</h2>
      <div class="product-grid" data-category="may-lazer" data-sub="laser-5-tia"></div>
    </section>

    <section id="laser-12-tia">
      <h2>Máy laser 12 tia</h2>
      <div class="product-grid" data-category="may-lazer" data-sub="laser-12-tia"></div>
    </section>

    <section id="laser-16-tia">
      <h2>Máy laser 16 tia</h2>
      <div class="product-grid" data-category="may-lazer" data-sub="laser-16-tia"></div>
    </section>

    <section id="phu-kien-laser">
      <h2>Phụ kiện laser</h2>
      <ul class="bullets">
        <li>Chân tripod nhôm/thép, clamp treo tường, giá đỡ 360°.</li>
        <li>Receiver/remote, pin/adapter, bệ nâng chỉnh vi cấp.</li>
      </ul>
      <div class="product-grid" data-category="may-lazer" data-sub="phu-kien-laser"></div>
    </section>

    <section id="faq">
      <h2>FAQ</h2>
      <details><summary>Chọn 5/12/16 tia thế nào?</summary><p>5 tia → cân cốt điểm/cửa; 12 tia → nội thất, ốp lát; 16 tia → bao phòng, công trình phức tạp.</p></details>
      <details><summary>Xanh hay đỏ?</summary><p>Xanh (520nm) sáng hơn trong nhà; đỏ tiết kiệm pin, ổn ngoài trời khi có receiver.</p></details>
    </section>
  </main>

  <footer class="container" style="margin-top:16px;border-top:1px solid var(--border,#eaeaea);padding:12px 0">
    <p>Icon danh mục: <img src="/assets/img/categories/may-laze.webp" alt="Máy cân bằng laser — MXD" width="64" height="64" loading="lazy"/></p>
  </footer>

  <!-- Guard render: nhận mọi biến thể tên danh mục (laze/lazer/laser/...) + chia nhóm theo số tia -->
  <script>
    // Chuẩn hóa chuỗi: bỏ dấu, ký tự lạ -> '-'
    const deaccent = s => String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    const norm = s => deaccent(s).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/-+/g,'-').replace(/(^-|-$)/g,'');

    // Chấp nhận các biến thể category
    const ALLOW_KEYS = [
      'may-lazer','may-laze','may-laser','may-can-bang-laser','laser','laze'
    ];
    const isAllowedCat = c => {
      const x = norm(c);
      return ALLOW_KEYS.some(k => x.startsWith(k));
    };

    const SUBS = ['laser-5-tia','laser-12-tia','laser-16-tia','phu-kien-laser'];

    // route theo name/sku/tags
    function routeSub(p){
      const s = norm((p.sku || '') + ' ' + (Array.isArray(p.tags)?p.tags.join(' '):'') + ' ' + (p.name||''));
      if (/\b(5-?tia|hk-e63|g2-ls300|t22|5-tia|ls300)\b/.test(s)) return 'laser-5-tia';
      if (/\b(16-?tia|kmls016|16tia|4d|akuza-4d|ak-x1)\b/.test(s)) return 'laser-16-tia';
      if (/\b(12-?tia|t97|ls1201|bs-1288ld|kh-12|g1-t85|12tia)\b/.test(s)) return 'laser-12-tia';
      if (/\b(tripod|chan|receiver|remote|gia-do|kep|clamp|battery|adapter|pin|sac)\b/.test(s)) return 'phu-kien-laser';
      // fallback mặc định phổ biến: 12 tia
      return 'laser-12-tia';
    }

    function priceText(v){ try{ const n=Number(v||0); return n? n.toLocaleString('vi-VN')+'₫':'Liên hệ'; }catch(e){ return 'Liên hệ'; } }
    function esc(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[m]))}

    function cardHTML(p){
      const url = p.origin || p.deeplink || '#';
      const img = p.image || '/assets/img/placeholder.webp';
      const name = esc(p.name||'');
      return `
      <article class="product-card" data-sku="${esc(p.sku||'')}" data-cat="${esc(p.category||'')}">
        <a class="thumb" href="${url}" target="_blank" rel="nofollow noopener" data-origin="${url}">
          <img loading="lazy" src="${img}" alt="${name}">
        </a>
        <div class="body">
          <h3 title="${name}"><a href="${url}" target="_blank" rel="nofollow noopener" data-origin="${url}">${name}</a></h3>
          <div class="price">${priceText(p.price)}</div>
          <div class="actions">
            <a class="btn" href="${url}" target="_blank" rel="nofollow noopener" data-origin="${url}">Mua trên Shopee</a>
          </div>
        </div>
      </article>`;
    }

    async function renderLaser(){
      try{
        const res = await fetch('/assets/data/affiliates.json',{cache:'no-store'});
        const all = await res.json();

        // Lọc đúng danh mục (chấp nhận biến thể)
        const valid = all.filter(p => p && p.status !== false && p.category && isAllowedCat(p.category));

        // Khử trùng lặp theo sku
        const seen = new Set();
        const list = valid.filter(p => !seen.has(p.sku) && seen.add(p.sku));

        // Gom bucket
        const buckets = Object.fromEntries(SUBS.map(k => [k, []]));
        for (const p of list){
          const sub = routeSub(p);
          if (buckets[sub]) buckets[sub].push(p);
        }

        // Render
        document.querySelectorAll('.product-grid[data-category]').forEach(grid=>{
          const sub = grid.getAttribute('data-sub');
          const items = buckets[sub] || [];
          grid.innerHTML = items.map(cardHTML).join('');
        });

        // Fallback nếu trống, đổ khoảng 8 sp bất kỳ để không “lỗ chỗ”
        for (const sub of SUBS){
          const grid = document.querySelector(`.product-grid[data-sub="${sub}"]`);
          if (grid && !grid.children.length){
            grid.innerHTML = list.slice(0,8).map(cardHTML).join('');
          }
        }

        // Cho affiliate rewrite link
        if (window.MXD && typeof MXD.affRewrite === 'function'){ MXD.affRewrite(); }
      }catch(err){
        console.error('[may-laze] render error:', err);
        if (window.MXD?.renderCategory) MXD.renderCategory('may-lazer');
        else if (window.MXD?.renderProducts) MXD.renderProducts('.product-grid');
      }
    }

    window.addEventListener('DOMContentLoaded', renderLaser);
  </script>
</body>
</html>
