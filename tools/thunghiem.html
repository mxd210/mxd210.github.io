<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Smart Affiliate JSON Generator</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 30px auto; padding: 20px; background: #f5f5f5; border-radius: 10px; }
    h2 { text-align: center; color: #444; }
    textarea, input { width: 100%; padding: 10px; margin-top: 10px; font-size: 14px; }
    button { padding: 10px 20px; margin-top: 15px; font-size: 16px; cursor: pointer; background: #1976d2; color: white; border: none; border-radius: 5px; }
    .output { margin-top: 20px; background: #fff; padding: 15px; border-radius: 5px; font-size: 13px; white-space: pre-wrap; }
    .highlight { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Smart Affiliate JSON Generator v1</h2>
  <input id="productUrl" placeholder="D√°n link s·∫£n ph·∫©m Shopee v√†o ƒë√¢y..." />
  <button onclick="fetchShopee()">L·∫•y d·ªØ li·ªáu</button>
  <div class="output" id="jsonOutput">JSON s·∫Ω hi·ªán t·∫°i ƒë√¢y...</div>
  <button onclick="copyJSON()">üìã Copy JSON</button>

  <script>
    async function fetchShopee() {
      const url = document.getElementById("productUrl").value.trim();
      if (!url.includes("shopee")) {
        alert("Hi·ªán t·∫°i ch·ªâ h·ªó tr·ª£ link Shopee.");
        return;
      }

      try {
        const proxy = "https://api.allorigins.win/raw?url=";
        const res = await fetch(proxy + encodeURIComponent(url));
        const html = await res.text();

        // Tr√≠ch ti√™u ƒë·ªÅ
        const title = html.match(/<title>(.*?)<\/title>/i)?.[1]?.replace(" | Shopee Vi·ªát Nam", "").trim() || "Kh√¥ng r√µ";

        // Gi√° (d·ª± ƒëo√°n theo ƒë·ªãnh d·∫°ng JSON trong trang)
        const priceMatch = html.match(/"price":(\d+)/);
        const oldPriceMatch = html.match(/"original_price":(\d+)/);

        const price = priceMatch ? parseInt(priceMatch[1]) / 100000 : 0;
        const old_price = oldPriceMatch ? parseInt(oldPriceMatch[1]) / 100000 : price;

        // Gi·∫£m %
        const discount = old_price && old_price > price ? Math.round((1 - price / old_price) * 100) : 0;

        // ·∫¢nh
        const imageMatch = html.match(/https:\/\/cf\.shopee\.vn\/file\/[a-zA-Z0-9]+/g);
        const images = [...new Set(imageMatch || [])].slice(0, 4);

        // Slug t·ª´ t√™n
        const slug = title.toLowerCase().replace(/[^\w\s\-]/gi, '').replace(/\s+/g, '-');

        // Sinh JSON
        const product = {
          slug,
          title,
          merchant: "shopee",
          price: Math.round(price * 1000),
          old_price: Math.round(old_price * 1000),
          discount_percent: discount,
          origin: url,
          images,
          desc: "",
          tags: [],
          seo: {
            description: ""
          }
        };

        document.getElementById("jsonOutput").textContent = JSON.stringify(product, null, 2);
      } catch (e) {
        alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu. C√≥ th·ªÉ Shopee ch·∫∑n tr√¨nh duy·ªát.");
        console.error(e);
      }
    }

    function copyJSON() {
      const json = document.getElementById("jsonOutput").textContent;
      navigator.clipboard.writeText(json);
      alert("ƒê√£ copy JSON!");
    }
  </script>
</body>
</html>
